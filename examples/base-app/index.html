<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Base App</title>
    <link rel="stylesheet" href="./style.css" />
    <script src="./index.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      .root {
        display: flex;
        place-content: center;
        margin-top: 3rem;
      }

      #container {
        background: #000;
        width: 640px;
        height: 398px;
      }

      .input {
        display: flex;
        margin-top: 10px;
        color: white;
        place-content: stretch;
      }

      .input input {
        flex: auto;
      }

      button {
        padding-left: 5px;
        padding-right: 5px;
      }
    </style>
  </head>

  <body class="page">
    <div class="root">
      <div class="container-shell">
        <div id="container"></div>
        <div class="input">
          <input autocomplete="on" id="playUrl" value="https://rtmp05open.ys7.com:9188/v3/openlive/BC7799091_1_1.flv?expire=1769089970&id=934536106903339008&t=2bbdf238fb574aaf8430250f14e0c064024ccf4a41bcb93e60d3b3e69f8e5d12&ev=101&supportH265=1" />
          <button id="init">初始化</button>
        </div>
        <div style="display: inline-flex">
          <button id="play">播放</button>
          <button id="screenshot">截图</button>
          <button id="startRecord">开始录制</button>
          <button id="stopRecord">停止录制</button>
          <button id="pause">停止</button>
          <button id="destroy">销毁</button>
          <select id="setDebug">
            <option value>打印日志</option>
            <option value="0">不打印日志</option>
          </select>
          <div title="只取小数点后两位，不进位">
            <label>音量：</label>
            <input
              placeholder="0~1"
              id="setVolume"
              type="number"
              step="0.01"
              style="width: 60px"
            />
          </div>
          <div>
            <label>旋转</label>
            <select id="setRotate" title="只支持 0 | 90 | 180 | 270">
              <option value="0">0度</option>
              <option value="90">90度</option>
              <option value="180">180度</option>
              <option value="270">270度</option>
            </select>
          </div>
          <div>
            <label>填充模式</label>
            <select id="setScaleMode" title="填充模式">
              <option value="0">完全填充区域（拉伸）</option>
              <option value="1" selected>等比缩放,最大边填充</option>
              <option value="2">等比缩放,最小边填充</option>
            </select>
          </div>
          <button id="getVersion">获取版本</button>
        </div>
      </div>
    </div>

    <script>
      var $init = document.getElementById("init");
      var $play = document.getElementById("play");
      var $screenshot = document.getElementById("screenshot");
      var $startRecord = document.getElementById("startRecord");
      var $stopRecord = document.getElementById("stopRecord");
      var $pause = document.getElementById("pause");
      var $playHref = document.getElementById("playUrl");
      var $container = document.getElementById("container");
      var $destroy = document.getElementById("destroy");
      var $getVersion = document.getElementById("getVersion");

      var $setDebug = document.getElementById("setDebug");
      var $setVolume = document.getElementById("setVolume");
      var $setRotate = document.getElementById("setRotate");
      var $setScaleMode = document.getElementById("setScaleMode");

      var player = null;

      function create() {
        player = new EzuikitFlv({
          // https://ezviz-openbiz.github.io/EZUIKit-flv/global.html#FlvOptions
          container: $container,
          url: $playHref.value,
          debug: true,
          downloadRecord: false, // 默认为 true, 录制完成后会自动下载， 设置为 false 后， 需要用户手动处理录制文件
          // autoPlay: true,
          // decoder: "decoder.js", // 自定义解码库加载地址， 默认放置在服务器根目录下
          // themeData: null // 忽略主题 @since 2.0.0
        });

        player.on("error", (msg) => {
          console.error(msg);
        });
      }

      $init.addEventListener(
        "click",
        function () {
          var href = $playHref.value;

          if (player) {
            player.destroy();
            player = null;
          }

          if (href) {
            create();
          }
        },
        false
      );

      $play.addEventListener(
        "click",
        function () {
          if (player) {
            player.play();
          }
        },
        false
      );

      $pause.addEventListener("click", function () {
        if (player) player.pause();
      });

      $screenshot.addEventListener("click", function () {
        if (player) player.screenshot();
      });

      // 开始录制 
      $startRecord.addEventListener("click", function () {
        // https://ezviz-openbiz.github.io/EZUIKit-flv/EzuikitFlv.html#startRecord
        if (player) player.startRecord(new Date().getTime()+'', (url, file) => {
          // downloadRecord = true 时， 会自动下载， 回调通知使用者录制已停止， 并返回录制文件地址和文件对象
          // downloadRecord = false 时，不会自动下载， 回调通知使用者录制已停止， 并返回录制文件地址和文件对象
          console.log("record result: ",url, file);
        });
      });
      // 停止录制
      $stopRecord.addEventListener("click", function () {
        // https://ezviz-openbiz.github.io/EZUIKit-flv/EzuikitFlv.html#stopRecord
        if (player) player.stopRecord();
      });

      $destroy.addEventListener("click", function () {
        if (player) {
          player.destroy();
          player = null;
        }
      });

      $getVersion.addEventListener("click", () => {
        if (player) {
          console.log(player.getVersion());
        }
      });

      $setDebug.addEventListener("change", (e) => {
        if (player) {
          player.setDebug(e.target.value !== "0");
        }
      });

      $setRotate.addEventListener("change", (e) => {
        if (player) {
          player.setRotate(e.target.value);
        }
      });
      $setScaleMode.addEventListener("change", (e) => {
        if (player) {
          player.setScaleMode(e.target.value);
        }
      });
      $setVolume.addEventListener("blur", (e) => {
        if (player) {
          const value = +e.target.value;
          player.muted = value <= 0;
          player.volume = +e.target.value;
        }
      });
    </script>
  </body>
</html>
